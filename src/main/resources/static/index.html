<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Java WebSocket Demo</title>
    <style>
        #messages { height: 300px; border: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        input { width: 70%; padding: 8px; }
        button { padding: 8px 12px; }
    </style>
</head>
<body>
<h2>Spring Boot WebSocket èŠå¤©å®¤</h2>
<div id="messages"></div>
<br>
<input type="text" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." />
<button onclick="sendMessage()">å‘é€</button>

<script>
    const messagesDiv = document.getElementById('messages');
    const input = document.getElementById('messageInput');

    // æ³¨æ„ï¼šè·¯å¾„è¦å’Œåç«¯ @RequestMapping ä¸€è‡´
    const ws = new WebSocket('ws://localhost:8080/ws');

    ws.onopen = () => appendMessage('ğŸŸ¢ è¿æ¥æˆåŠŸï¼');
    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        appendMessage(data.type === 'chat' ? `ğŸ’¬ ${data.text}` : `â„¹ï¸ ${data.message}`);
    };
    ws.onclose = () => appendMessage('ğŸ”´ è¿æ¥æ–­å¼€');
    ws.onerror = () => appendMessage('âŒ è¿æ¥é”™è¯¯');

    function appendMessage(text) {
        const p = document.createElement('p');
        p.textContent = text;
        messagesDiv.appendChild(p);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function sendMessage() {
        const msg = input.value.trim();
        if (msg) {
            ws.send(msg);
            input.value = '';
        }
    }

    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>
</body>
</html>